<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <!-- CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="style.css" rel="stylesheet" type="text/css" />
        
        <title>Title</title>
    </head>
    <body>
        <!-- HTML -->
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="script.js"></script>
        <script type="module">

            // import kaboom lib
            import kaboom from "https://unpkg.com/kaboom@3000.0.1/dist/kaboom.mjs";
            
            // initialize kaboom context
        kaboom({
            background: [89, 216, 255],
        });
            const SPEED = 480

            setGravity(1300)

            loadSprite("bean", "sprites/bean.png")
            loadSprite("bean2", "sprites/bean2.png")
            loadSprite("ghosty", "sprites/ghosty.png")
            loadSprite("steel", "sprites/steel.png")
            loadSprite("bag", "sprites/bag.png")
            loadSprite("philostone", "sprites/philostone1.png")
            loadSprite("yowaimo1", "sprites/yowaimo1.png")
            loadSprite("wow", "sprites/wow.png")
            loadSprite("sleepy02", "sprites/sleepy02.png")
            loadSprite("grass", "sprites/grass.png")
            loadSprite("owl", "sprites/owl.png")
            loadSprite("etris", "sprites/etris.png")
            loadSprite("savior", "sprites/savior.png")
            loadSprite("02ing", "sprites/02ing.png")
            loadSprite("layer2", "sprites/layer2.png")
            loadSprite("klaris", "sprites/klaris.png")
            loadSprite("nair", "sprites/nair.png")
            loadSprite("kazotiey", "sprites/kazotiey.png")
            loadSprite("sukuna", "sprites/sukuna.png")
            // Our win screen once conditions are met to win
            // scene("win", () => {
            //     add([
            //         text("You Win!"),
            //         pos(width() / 2, height() / 2),
            //         anchor("center"),
            //     ])
            // })
            
            add([
                sprite("bean2"),
                pos(300, 40),
                // Both objects must have area() component to enable collision detection between
                area(),
                body(),
                "bean2"
            ])
        
            const player = add([
                sprite("bean"),
                pos(40, 80),
                area(),
                body(),
                health(8)
            ])

            // player.onUpdate(() => {
            //     camPos(player.pos)
            // })

            // onKeyPress("space", () => {
            //     if (player.isGrounded()) {
            //         player.jump()
            //     }
            // })

            // onKeyDown("a", () => {
            //     player.move(-SPEED, 0)
            // })

            // onKeyDown("d", () => {
            //     player.move(SPEED, 0)
            // })

            // onKeyDown("s", () => {
            //     player.move(0, SPEED)
            // })

            // onKeyDown("s", () => {
            //     player.move(0, SPEED)
            // })

            player.onUpdate(() => {
                if (player.isHovering()) {
                    player.color = rgb(255, 0, 255)
                } else {
                    player.color = rgb()
                }
            })
            // player.onCollide("enemy", (enemy) => {
            //     destroy(enemy)
            // })
    
            // for (let i = 0; i < 20; i++) {
            //     const x = rand(0, width())
            //     const y = rand(0, height()) 
            //     add([
            //         sprite("ghosty"),
            //         pos(x, y),
            //         area(),
            //         body(),
            //         "enemy",
            //     ])
            //  }
             
            // player.onCollide("enemy", (enemy) => {
            //     go("win")
            // })
            // scene("Start", () => {
            //     add([
            //         text("Press space to start"),
            //         pos(width() / 2, height() / 2),
            //         anchor("center"),
            //     ])
            // })
            // go("Start")
            // onKeyPress("space", () => {
            //     go("main",)
            // })
            const layout = [
                [
                "= = = = = = = = = = = = = = =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=            # # #          =",
                "                             ",
                "=            # @ #          =",
                "                             ",
                "=            # # #          =",
                "                             ",
                "=                           =",
                "            *   +            ",
                "=                           =",
                "                             ",
                "=                        -  =",
                "                             ",
                "=                           =",
                "                             ",
                "= = = = = = = = = = = = = = =",
                ],
                [
                "= = = = = = = = = = = = = = =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                           =",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                 = = = =    ",
                "                             ",
                "=                           = = = = = = = = = = = = = = =",
                "                !            ",
                "=                           =",
                "                             ",
                "=         = = = =           =",
                "                             ",
                "=                           =",
                "    !                        ",
                "=                           =",
                "                             ",
                "=   = = = =                 = = = = = =",
                "                                       ",
                "=    @                      =          ",
                "              !                        ",
                "=                           =     -    ",
                "                                       ",
                "=                           =          ",
                "                                       ",   
                "= = = = = = = = = = = = = = = = = = = =", 
                "                                       ",
                "                                       ",
                "                                       ",
                "                                                 !      ",
                "                                                        ",
                "                                                        ",        
                "                                         = = = = = = = =",
                ],
                [
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                            ",
                "                             ",
                "=                  $                   $                 $",
                "        @                    ",
                "=                            ",
                "                             ",
                "= = = = = =        =                   =                 =                - ",
                ],
                // [
                // "                             ",
                // "                             ",
                // "=                            ",
                // "                             ",
                // "=                            ",
                // "                             ",
                // "=        %                   ",
                // "                @            ",
                // "=                            ",
                // "      = = = = = =            ",
                // "=                         -  ",
                // "                             ",
                // "=                            ",
                // "                             ",
                // "= = = = = = = = = = = = = = =",
                // ],
                // [
                // "                             ",
                // "                             ",
                // "=                            ",
                // "                             ",
                // "=          &                 ",
                // "           &                 ",
                // "=                            ",
                // "         & &       @         ",
                // "=                            ",
                // "      = = = = = =            ",
                // "=                         -  ",
                // "                             ",
                // "=                            ",
                // "                             ",
                // "= = = = = = = = = = = = = = =",
                // ],
                ]
            const mapItems =  {
                tileWidth: 32,
                tileHeight: 32,
                tiles: {
                    "=": () => [
                        sprite("steel"),
                        area(),
                        body({ isStatic: true }),
                        "steel",
                    ],
                    "#": () => [
                        sprite("grass"),
                        area(),
                        body({ isStatic: true }),
                        "grass",
                    ],
                    "@": () => [
                        sprite("philostone"),
                        area(),
                        body({ isStatic: true}),
                        scale(1/10),
                        body(),
                        "philostone",
                    ],
                    "*": () => [
                        sprite("owl"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.1),
                        "enemy",
                    ],
                    "!": () => [
                        sprite("etris"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.2),
                        "enemy",
                    ],
                    "$": () => [
                        sprite("nair"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.2),
                        "enemy",
                    ],
                    "%": () => [
                        sprite("02ing"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.3),
                        "enemy",
                    ],
                    "&": () => [
                        sprite("layer2"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.1),
                        "enemy",
                    ],
                    "+": () => [
                        sprite("kazotiey"),
                        area(),
                        body({ isStatic: true}),
                        body(),
                        scale(0.34),
                        "enemy",
                    ],
                    "-": () => [
                        sprite("klaris"),
                        area(),
                        body({ isStatic: true}),
                        "klaris",
                        scale(0.2)
                    ],
                },
            }
            scene("game", ({level_id, kills} = {level_id: 0, kills: 0}) => {
                const level = addLevel(layout[level_id ?? 0], mapItems)
            // addLevel(levels[levelIdx], {
            //     tileWidth: 32,
            //     tileHeight: 32,
            //     tiles: {
            //         "=": () => [
            //             sprite("steel"),
            //             area(),
            //             body({ isStatic: true }),
            //             "steel",
            //         ],
            //         "@": () => [
            //             sprite("philostone"),
            //             area(),
            //             body({ isStatic: true}),
            //             scale(1/10),
            //             body(),
            //             "philostone",
            //         ]
            //     }
            // })
            // let enemy = add([
            //         sprite("ghosty"),
            //         pos(300,100),
            //         area(),
            //         body(),
            //         anchor("center"),
            //         "enemy",
            //     ])
            const enemySpeed = 100
            
            // for (let i = 0; i < 5; i++) {
            //     const x = rand(0, width())
            //     const y = rand(0, height()) 
            //     let enemy = add([
            //         sprite("ghosty"),
            //         pos(x, y),
            //         area(),
            //         body(),
            //         anchor("center"),
            //         "enemy",
            //     ])
            //  }
             let player = add([
                sprite("sukuna"),
                pos(60, 800),
                area(),
                body(),
                health(8),
                anchor("center"),
                scale(0.05),
            ])
            player.onCollide("enemy", (enemy) => {
                if(player.pos.y < enemy.pos.y){
                destroy(enemy)
                console.log(destroy(enemy))
                kills++
                scorelabel.text = 'Score ' + kills
                player.jump(800)
                }
                else{
                    go("lose")
                    destroy(player)
                }
            })
            // player.onCollide("enemy", (e, col) => {
            //     // if it's not from the top, die
            //     if (!col.isBottom()) {
            //         go("lose")
            //     }
            //     else{
            //         player.jump(500)
            //         destroy(enemy)
            //     }
            // })
            player.onCollide("klaris", () => {
               if(philostone){
                    if (level_id + 1 < layout.length) {
                        go("game",{
                            level_id: level_id + 1,
				            kills: kills,
                        })
                    } else {
                        go("win")
                    }
               }
            })
            let philostone = false
            player.onCollide("philostone", (key) => {
                destroy(key)
                philostone = true
            })
            console.log(philostone)
            player.onUpdate(() => {
                camPos(player.pos)
                if(player.pos.y >= 2400){
                    go("lose")
                }
            })
           
            onKeyPress("space", () => {
                if (player.isGrounded()) {
                    player.jump()
                }
            })

            onKeyDown("a", () => {
                player.move(-SPEED, 0)
            })

            onKeyDown("d", () => {
                player.move(SPEED, 0)
            })

            onKeyDown("s", () => {
                player.move(0, SPEED)
            })

            onKeyDown("s", () => {
                player.move(0, SPEED)
            })
            scene("win", () => {
                add([
                    text("You Win!"),
                    pos(width() / 2, height() / 2),
                    anchor("center"),
                ])
            })
            scene("lose", () => {
                add([
                    sprite("wow"),
                    pos(-700,-150),
                    area(),
                    scale(1.5),
                ])
                add([
                    text("You LOST"),
                    color(255,0,0),
                    pos(width() / 2, height() / 2),
                    anchor("center"),
                    scale(5)
                ])
                
            })
            player.onHeadbutt((obj) => {
                if(obj.is("grass")){
                    destroy(obj)
                    kills++
                    scorelabel.text = 'Score ' + kills
                    console.log(kills)
                }
            })
            const labels = add([
                text('Level ' + level_id),
                pos(0,0),
                fixed(),
                scale(2),
            ])
            const scorelabel = add([
                text('Score ' + kills),
                pos(0,100),
                fixed(),
                scale(2),
            ])
        })
            const score = add([
                text('0'),
                pos(50, 50),
                scale(3),
                {
                    value: 0,
                }
            ])          
            
            const new1 = add([
                text('FP NOT DONE'),
                pos(150, 50),
                scale(4),
            ])
            go("game",)
            </script>
    </body>
</html>
